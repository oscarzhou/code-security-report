# code-security-report

A tool for analyzing the reports generated by various code security scanning tools (i.e. Snyk, Trivy). It is inspired by and designed for Github Action Workflow integration.   


## Supported Report Type

1. Snyk
2. Trivy

## Examples in Github Action Workflow


### 1. Get summary

```
- name: Analyse the js result
if: >-
    github.ref == 'refs/heads/main' ||
    github.ref== 'refs/heads/master'
id: set-matrix
run: | 
    result=$(docker run --rm -v /home/runner/work/repo:/data oscarzhou/code-security-report:0.1.5 summary -report-type=snyk -path="/data/snyk.json" -output-type=matrix)
    echo "::set-output name=js_result::${result}"
```

### 2. Diff two reports

```
- name: Analyse the go diff result
if: >-
    github.ref != 'refs/heads/main' && 
    github.ref != 'refs/heads/master'
id: set-diff-matrix
run: | 
    result=$(docker run --rm -v /home/runner/work/repo:/data oscarzhou/code-security-report:0.1.5 diff -report-type=snyk -path="/data/go-snyk-feature.json" -compare-to="./data/go-snyk-develop.json" -output-type=matrix)
    echo "::set-output name=go_diff_result::${result}"
```

### 3. Export summary result 

```
- name: Export scan result to html file 
run: | 
    $(docker run --rm -v ${{ github.workspace }}:/data oscarzhou/code-security-report:0.1.8 summary -report-type=snyk -path="/data/snyk.json" -output-type=table -export -export-filename="/data/go-result")

- name: Upload go result html file
uses: actions/upload-artifact@v3
with:
    name: html-go-result-${{github.run_id}}
    path: go-result.html
```

### 4. Export diff result

```
- name: Export scan result to html file 
run: | 
    $(docker run --rm -v ${{ github.workspace }}:/data oscarzhou/code-security-report:0.1.8 diff -report-type=snyk -path="/data/go-snyk-feature.json" -compare-to="/data/go-snyk-develop.json" -output-type=table -export -export-filename="/data/go-result")

- name: Upload go result html file
uses: actions/upload-artifact@v3
with:
    name: html-go-result-compare-to-develop-${{github.run_id}}
    path: go-result.html

```

## Examples in CLI

### 1. Get summary of the report

`./scanreport summary -report-type=snyk -path="./snyk-feature.json" -output-type=matrix`

#### Output: 

```
[
   {
      "ScannedObjects": 365,
      "critical": 0,
      "high": 3,
      "medium": 2,
      "low": 0,
      "unknown": 0,
      "total": 5,
      "FixableCritical": 0,
      "FixableHigh": 2,
      "FixableMedium": 0,
      "FixableLow": 0,
      "FixableUnknown": 0,
      "summary": "Tested 365 dependencies for known issues. Total: High:3 Medium:2",
      "status": "failure"
   }
]
```

### 2. Compare two reports

`./scanreport diff -report-type=snyk -path="./snyk-feature.json" -compare-to="./snyk-develop.json" -output-type=matrix`

#### Output:

```
[
  {
     "Base": {
         "ScannedObjects": 365,
         "critical": 0,
         "high": 3,
         "medium": 0,
         "low": 0,
         "unknown": 0,
         "total": 3,
         "FixableCritical": 0,
         "FixableHigh": 2,
         "FixableMedium": 0,
         "FixableLow": 0,
         "FixableUnknown": 0,
         "summary": "Tested 365 dependencies for known issues. Total: High:3",
         "status": "failure"
     },
     "Fixed": {
         "ScannedObjects": 0,
         "critical": 0,
         "high": 0,
         "medium": 0,
         "low": 0,
         "unknown": 0,
         "total": 0,
         "FixableCritical": 0,
         "FixableHigh": 0,
         "FixableMedium": 0,
         "FixableLow": 0,
         "FixableUnknown": 0,
         "summary": "Tested 365 dependencies for known issues. Total: Nothing found",
         "status": ""
     },
     "NewFound": {
         "ScannedObjects": 0,
         "critical": 0,
         "high": 0,
         "medium": 2,
         "low": 0,
         "unknown": 0,
         "total": 2,
         "FixableCritical": 0,
         "FixableHigh": 0,
         "FixableMedium": 0,
         "FixableLow": 0,
         "FixableUnknown": 0,
         "summary": "Tested 365 dependencies for known issues. Total: Medium:2",
         "status": ""
     },
     "Summary": "Base summary:Tested 365 dependencies for known issues. Total: High:3, Fixed summary:Tested 365 dependencies for known issues. Total: Nothing found, New found summary:Tested 365 dependencies for known issues. Total: Medium:2.",
     "Status": "failure"
  }
]
```

### 3. Export the summary report


`./scanreport summary -report-type=snyk -path="./fixtures/snyk-feature.json" -export -output-type=table -export-filename="snyk-summary"`


### 4. Export the diff report

`./scanreport diff -report-type=snyk -path="./fixtures/snyk-feature.json" -compare-to="./fixtures/snyk-develop.json" -output-type=table -export`

### 5. Debug with ls command

`docker run --rm -v $PWD/fixtures:/data oscarzhou/code-security-report:latest ls -path=/data`


### 6. Check version

`./scanreport version` 

## Examples with docker

### 1. Run with docker container

`docker run --rm -v $PWD/fixtures:/data oscarzhou/code-security-report:<version> summary -report-type=snyk -path="/data/snyk.json"`

### 2. Export with docker container

`docker run --rm -v $PWD/fixtures:/data oscarzhou/code-security-report:<version> diff -report-type=snyk -path="./data/snyk-feature.json" -compare-to="./data/snyk-develop.json" -output-type=table -export -export-filename="./data/snyk-diff"`


## Command detail

`./scanreport help`
